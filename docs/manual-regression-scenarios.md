# Мануальные сценарии регресса

## Регистрация и утверждение свободного механика (базовый/премиум)
**Given** публичная форма регистрации свободного агента доступна.  
**When** пользователь вводит телефон `+79995550101`, пароль, анкету с ФИО, датой рождения, опытом, регионом, отмечает самозанятость и отправляет заявку.  
**Then** создаётся пользователь с ролью MECHANIC и account_type `FREE_MECHANIC_BASIC`, профиль в статусе unverified/inactive, заявка видна Администрации.

**When** Администрация утверждает заявку и выбирает тариф `FREE_MECHANIC_PREMIUM`.  
**Then** аккаунт становится активным и верифицированным, account_type обновляется на `FREE_MECHANIC_PREMIUM`, создаётся личный склад, в кабинете механика отображается премиальный доступ.

## Заявка на аттестацию и её утверждение
**Given** активный механик с подтверждённым профилем.  
**When** он отправляет аттестацию с requestedGrade `MIDDLE`.  
**Then** заявка создаётся в статусе `PENDING` и отображается у Администрации.  
**When** Администрация подтверждает заявку.  
**Then** статус меняется на `APPROVED`, в профиле выставлены флаги верификации/сертификации, механик виден в базе специалистов.

## Работа со складом и заявками на запчасти
**Given** свободный механик с личным складом и деталью `ZIP-200`.  
**When** он создаёт maintenance request и добавляет позицию с catalog_number `ZIP-200`.  
**Then** позиция автоматически помечается как доступная, связывается с личным складом и отражает адрес хранения.

## Поставка, частичная приёмка, жалоба на поставщика
**Given** менеджер оформил заказ поставщику и получил частичную поставку.  
**When** в приёмке отмечается accepted_quantity меньше запрошенного и добавляется комментарий.  
**Then** заказ получает статус частичной приёмки, на склад начисляется принятый объём.  
**When** менеджер создаёт жалобу с is_complaint=true и complaint_title.  
**Then** в supplier_reviews фиксируется спор, рейтинг поставщика пересчитывается, статус спора отображается в кабинете Администрации.

## Ветка «механик не может выполнить работы»
**Given** у механика есть активная заявка на обслуживание.  
**When** он отмечает одну или несколько позиций help_requested=true через кнопку «Нужна помощь».  
**Then** создаётся событие MECHANIC_HELP_REQUESTED, уведомления уходят менеджеру клуба и Администрации.  
**When** менеджер подтверждает или отклоняет запрос с комментарием.  
**Then** статус запроса обновляется, механик видит ответ в своём кабинете, в уведомлениях фиксируется действие.

## Просмотр техинформации и истории обслуживания
**Given** менеджер клуба авторизован.  
**When** он открывает экран «Техническая информация».  
**Then** отображаются модели, серийные номера, проценты состояния, даты последнего/следующего ТО и компоненты для оборудования его клуба.  
**When** он переходит в «Журнал работ» и фильтрует по периоду.  
**Then** видит только работы своего клуба, исполнителей, использованные запчасти, даты создания/завершения.

## Работа кабинета Администрации
**Given** пользователь с ролью ADMIN и account_type MAIN_ADMIN.  
**When** он открывает кабинеты заявок: регистрации, аттестации, запросы помощи, споры с поставщиками.  
**Then** отображаются все очереди с фильтрами и статусами; админ может утверждать/отклонять регистрации, менять account_type свободных механиков, привязывать или отвязывать механиков к клубам, обновлять complaint_status у supplier_reviews и статусы обращений.
